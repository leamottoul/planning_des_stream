<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Calendrier des Streams leatvlive</title>

  <link rel="stylesheet" href="style.css" />

  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore-compat.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

  <script src="var.js"></script>
  <script src="users.js"></script>

  <script>
    window.CryptoJs = CryptoJS
    
    const firebaseConfig = JSON.parse(atob(CryptoJS.AES.decrypt(window.firebaseConfigString, atob(window.CryptoSalt)).toString(CryptoJS.enc.Utf8)))

    firebase.initializeApp(firebaseConfig)
    const db = firebase.firestore()
  </script>

  <script src="main.js"></script>
</head>

<body>
  <div class="stars" id="stars"></div>
  <div class="container">
    <h1 id="month-year">✨ Calendrier des Streams leatvlive.tv</h1>
    <div style="background: #fff4f4; border: 1px solid #ff6b6b; padding: 8px 12px; border-radius: 10px; color: #b00020; font-size: 0.75em; margin: 20px auto; text-align: center; max-width: 500px;">
      ⚠️ Le planning est à titre informatif et n'engage à rien. Celui-ci peut être modifié à tout moment et ne pas être
      respecté à 100%. Merci à vous ⚠️
    </div>

    <div class="calendar-header">
      <button onclick="changeMonth(-1)">⬅️ Mois précédent</button>
      <button id="authBtn" onclick="handleAuth()">🔒 Modifier le planning</button>
      <button onclick="changeMonth(1)">Mois suivant ➡️</button>
    </div>

    <div class="calendar" id="calendar-days" style="min-height: 300px; border: 1px dashed #ccc; padding: 10px;"></div>
    <div style="display:flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 20px;">
      <div>
        <input id="secretInput" type="text" placeholder="Entre le mot magique"
          style="padding:8px; border-radius:8px; border:1px solid #ccc;" />
        <button onclick="checkSecretWord()"
          style="margin-left:10px; padding:8px 12px; border:none; border-radius:8px; background:#6c4db4; color:white; cursor:pointer;">
          ✨ Valider
        </button>
      </div>
      <div id="secretHint" data-secret="magic" style="display:none;"></div>

      <div style="display: flex; gap: 10px;">
        <button onclick="openModal('settingsModal')"
          style="background:#6c4db4; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">
          ⚙️ Paramètres
        </button>
        <button id="adminBtn" onclick="openModal('parametreAdmin')"
          style="display:none; background:#b04db4; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">
          ⚙️ Admin
        </button>
      </div>
    </div>

    <!-- Popup magique -->
    <div class="modal" id="magicModal" style="display:none">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('magicModal')">❌</span>
        <h2>🌈 Félicitations !</h2>
        <p>Tu as découvert le mot magique ✨<br>Une pluie d’étoiles t’accompagne !</p>
      </div>
    </div>

    <!-- Le contenu HTML est géré dynamiquement via JavaScript Firebase Firestore -->
    <div class="modal" id="loginModal" style="display:none">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('loginModal')">❌</span>
        <h2 id="authTitle">Connexion</h2>
        <input type="text" id="loginUser" placeholder="Nom d'utilisateur" />
        <input type="password" id="loginPass" placeholder="Code sécurisé" />
        <button onclick="validateLogin()">✅ Valider</button>
      </div>
    </div>
    <div class="modal" id="editModal" style="display:none">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('editModal')">❌</span>
        <h2>Modifier le jour</h2>
        <input type="text" id="title" placeholder="Titre du stream" />
        <select id="type">
          <option value="Minecraft">Minecraft</option>
          <option value="GTA">GTA RP</option>
          <option value="Chat">Just Chatting</option>
          <option value="Test">Test/Setup</option>
          <option value="Off">Off/Pause</option>
        </select>
        <select id="hour">
          <option value="13h00">13h00</option>
          <option value="15h00">15h00</option>
          <option value="18h00">18h00</option>
          <option value="20h00">20h00</option>
          <option value="--h--">--h--</option>
        </select>
        <button onclick="saveEdit()">💾</button>
        <button onclick="deleteDay()">🗑️</button>
      </div>
    </div>
    <!-- Popup Paramètres -->
    <div class="modal" id="settingsModal" style="display:none">
      <div class="modal-content" style="width: 400px; padding: 20px; border-radius: 16px;">
        <span class="close-btn" onclick="closeModal('settingsModal')">❌</span>
        <h2>⚙️ Paramètres</h2>
        <p>Tu peux personnaliser ton expérience magique ici ✨</p>
        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
          <button onclick="toggleStars()" id="toggleStarsBtn"
            style="background:#6c4db4; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">
            ✨ Activer les étoiles
          </button>
          <p id="starsLockedMsg" style="display:none; color: #b00020; font-size: 0.8em; margin-top: 4px;">
            ⚠️ Cette option est bloquée par l’admin 😓
          </p>

          <button onclick="toggleTheme()"
            style="background:#6c4db4; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">
            🎨 Mode Sombre / Clair
          </button>
        </div>
        <!-- Les options arriveront ici ensuite -->
      </div>
    </div>
    <!-- Popup Paramètres Admin -->
    <div class="modal" id="parametreAdmin" style="display:none">
      <div class="modal-content"
        style="background: #4b1f5a; color: white; border-radius: 16px; padding: 20px; min-width: 300px;">
        <span class="close-btn" onclick="closeModal('parametreAdmin')">❌</span>
        <h2>🛠️ Paramètres Admin</h2>

        <!-- Onglets -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <button onclick="switchAdminTab('tabMagic')" id="tabMagicBtn" style="flex:1">🪄 Mot magique</button>
          <button onclick="switchAdminTab('tabSettings')" id="tabSettingsBtn" style="flex:1">⚙️ Paramètres</button>
          <button onclick="switchAdminTab('tabLog')" id="tabLogBtn" style="flex:1">📋 Historique</button>
        </div>

        <!-- Contenus -->
        <div id="tabMagic" class="admin-tab">
          <label>🔒 Mot magique global</label>
          <input type="text" id="adminMagicWord" placeholder="Ex: licorne"
            style="padding:6px; border-radius:8px; border:none; margin-bottom:10px; width:100%;" />

          <label>✨ Texte du popup magique</label>
          <textarea id="adminPopupMessage" rows="4"
            style="width: 100%; padding:6px; border-radius:8px; margin-bottom:10px;"></textarea>

          <button onclick="saveAdminSettings()"
            style="padding: 10px 20px; background: #6c4db4; color: white; border: none; border-radius: 10px; cursor: pointer;">
            💾
          </button>
        </div>
        <div id="tabSettings" class="admin-tab" style="display:none;">
          <label>🌟 Étoiles magiques forcées</label>
          <select id="adminStarsMode" style="width: 100%; padding:6px; border-radius:8px; margin-bottom:10px;">
            <option value="auto">Auto (chaque utilisateur)</option>
            <option value="on">Forcé : Activées</option>
            <option value="off">Forcé : Désactivées</option>
          </select>
          <button onclick="saveAdminSettings()"
            style="margin-top: 10px; padding: 10px 20px; background: #6c4db4; color: white; border: none; border-radius: 10px; cursor: pointer;">
            💾
          </button>
        </div>
        <div id="tabLog" class="admin-tab" style="display:none;">
          <div id="adminLogContainer" style="max-height: 300px; overflow-y: auto; font-size: 0.9em;">
            <p>Chargement de l'historique...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>