from ace_tools import save_file

# Code HTML tr√®s long, fourni dans un fichier pour t√©l√©chargement direct
code_content = """
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendrier Magique des Streams</title>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      background: #f3f0ff;
      color: #222;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    .container {
      background: #292a3e;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      width: 100%;
    }
    h1 { text-align: center; color: #6c4db4; }
    .calendar-header, .admin-panel {
      display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 15px;
    }
    .calendar-header button, .admin-panel button {
      padding: 8px 12px;
      background: #6c4db4;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
    }
    .admin-panel input, .admin-panel select {
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .calendar { margin-top: 20px; min-height: 300px; border: 1px dashed #ccc; padding: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="month-year">‚ú® Calendrier Magique des Streams</h1>
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">‚¨ÖÔ∏è Mois pr√©c√©dent</button>
      <button id="authBtn" onclick="handleAuth()">üîí Modifier le planning</button>
      <button onclick="changeMonth(1)">Mois suivant ‚û°Ô∏è</button>
      <button id="showGeneralBtn" onclick="toggleGeneral()" style="display:none">‚öôÔ∏è Modification g√©n√©rale</button>
    </div>
    <div class="calendar" id="calendar-days"></div>

    <div style="text-align:center;margin-top:20px;">
      <input id="secretInput" type="text" placeholder="Mot magique" />
      <button onclick="checkSecretWord()">‚ú® Valider</button>
      <div id="secretHint" data-secret="magic" style="display:none;"></div>
    </div>

    <div class="admin-panel" id="generalPanel" style="display:none; background:#5b3b8d; padding:15px; margin-top:20px; border-radius:10px; color:white;">
      <label>Titre: <input id="calendarTitle" /></label>
      <label>Style √©toiles: 
        <select id="starStyle">
          <option value="classic">Classic</option>
          <option value="sparkle">Sparkle</option>
        </select>
      </label>
      <label>Mot magique: <input id="magicWordInput" /></label>
      <label>Musique (URL): <input id="musicUrl" /></label>
      <label>Message magique: <input id="popupMessage" /></label>
      <button onclick="saveGeneralSettings()">üíæ Sauvegarder</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBI0e7UVfPb9_HimzEsqUF24PiJjuMO6WY",
      authDomain: "planning-twitch-leatvlive.firebaseapp.com",
      projectId: "planning-twitch-leatvlive",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const users = { "leamc": "mdp2025" };
    let editUnlocked = false;

    function handleAuth() {
      const pass = prompt("Mot de passe :");
      const user = prompt("Nom d'utilisateur :");
      if (users[user] === pass) {
        editUnlocked = true;
        document.getElementById("authBtn").textContent = "üö™ D√©connexion";
        document.getElementById("showGeneralBtn").style.display = "inline-block";
        alert("üîì Connect√© !");
      } else {
        alert("Erreur d‚Äôidentifiants.");
      }
    }

    function toggleGeneral() {
      const panel = document.getElementById("generalPanel");
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    }

    async function loadGeneralSettings() {
      const ref = db.collection("config").doc("general");
      const snap = await ref.get();
      if (!snap.exists) return;
      const data = snap.data();
      if (data.title) document.getElementById("month-year").textContent = data.title;
      if (data.magicWord) document.getElementById("secretHint").setAttribute("data-secret", data.magicWord);
      if (data.popupMessage) alert(data.popupMessage);
      if (data.musicUrl) {
        const audio = new Audio(data.musicUrl);
        audio.loop = true;
        audio.volume = 0.5;
        audio.play().catch(()=>{});
      }
      document.getElementById("calendarTitle").value = data.title || "";
      document.getElementById("magicWordInput").value = data.magicWord || "";
      document.getElementById("popupMessage").value = data.popupMessage || "";
      document.getElementById("musicUrl").value = data.musicUrl || "";
      document.getElementById("starStyle").value = data.starStyle || "classic";
    }

    async function saveGeneralSettings() {
      const data = {
        title: document.getElementById("calendarTitle").value.trim(),
        magicWord: document.getElementById("magicWordInput").value.trim(),
        musicUrl: document.getElementById("musicUrl").value.trim(),
        popupMessage: document.getElementById("popupMessage").value.trim(),
        starStyle: document.getElementById("starStyle").value,
      };
      await db.collection("config").doc("general").set(data);
      alert("‚úÖ Param√®tres enregistr√©s !");
    }

    function checkSecretWord() {
      const input = document.getElementById("secretInput").value.trim().toLowerCase();
      const correct = document.getElementById("secretHint").getAttribute("data-secret");
      if (input === correct) {
        alert("‚ú® Mot magique valid√© !");
      } else {
        alert("‚ùå Mot incorrect.");
      }
    }

    function changeMonth() {
      // √† compl√©ter plus tard
    }

    window.addEventListener("DOMContentLoaded", loadGeneralSettings);
  </script>
</body>
</html>
"""

save_file("/mnt/data/index_complet_calendrier_magique.html", code_content)
